<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Validador de N√∫meros - Loter√≠a MX</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f8fafc;
      color: #1e293b;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(37,99,235,0.10);
      padding: 32px;
    }
    h1 {
      text-align: center;
      color: #2563eb;
      margin-bottom: 18px;
    }
    .game-section {
      margin-bottom: 32px;
    }
    label {
      font-weight: 600;
      margin-right: 8px;
    }
    input[type="text"] {
      width: 220px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
      margin-bottom: 8px;
      font-size: 1em;
    }
    button {
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 24px;
      font-size: 1em;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #1e40af;
    }
    .result {
      background: #f1f5f9;
      border-radius: 8px;
      padding: 16px;
      margin-top: 18px;
      font-size: 1.1em;
    }
    .aciertos {
      color: #10b981;
      font-weight: bold;
    }
    .desviacion {
      color: #f59e0b;
      font-weight: bold;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      color: #64748b;
      font-size: 0.95em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Validador de N√∫meros</h1>
    <form id="validador-form">
      <div class="game-section">
        <label for="melate">Melate (6 n√∫meros):</label>
        <input type="text" id="melate" name="melate" placeholder="Ej: 5, 12, 23, 28, 34, 45">
        <label><input type="checkbox" id="melate-todos" name="melate-todos"> Validar todos</label>
      </div>
      <div class="game-section">
        <label for="retro">Melate Retro (6 n√∫meros):</label>
        <input type="text" id="retro" name="retro" placeholder="Ej: 3, 8, 19, 22, 31, 39">
        <label><input type="checkbox" id="retro-todos" name="retro-todos"> Validar todos</label>
      </div>
      <div class="game-section">
        <label for="tris">Tris (5 n√∫meros):</label>
        <input type="text" id="tris" name="tris" placeholder="Ej: 1, 2, 3, 4, 5">
        <label><input type="checkbox" id="tris-todos" name="tris-todos"> Validar todos</label>
      </div>
      <div class="game-section">
        <label for="chispazo">Chispazo (5 n√∫meros):</label>
        <input type="text" id="chispazo" name="chispazo" placeholder="Ej: 7, 14, 18, 22, 27">
        <label><input type="checkbox" id="chispazo-todos" name="chispazo-todos"> Validar todos</label>
      </div>
      <button type="submit">Validar</button>
    </form>
    <div id="resultados"></div>
    <div class="footer">
      <p>ü§ñ Valida tus n√∫meros contra los √∫ltimos resultados de cada juego.</p>
      <p>Los resultados se actualizan diariamente.</p>
    </div>
  </div>
  <script>
    // Obtiene los √∫ltimos resultados de los an√°lisis publicados
    async function obtenerResultados() {
      const fuentes = {
        melate: 'ANALISIS.md',
        retro: 'ANALISIS_RETRO.md',
        tris: 'ANALISIS_TRIS.md',
        chispazo: 'ANALISIS_CHISPAZO.md'
      };
      const resultados = {};
      const sorteos = {};
      for (const [juego, url] of Object.entries(fuentes)) {
        try {
          const res = await fetch(url);
          const txt = await res.text();
          // Extraer los √∫ltimos 5 sorteos (simulaci√≥n: busca l√≠neas con n√∫meros)
          let lines = txt.split('\n').filter(l => l.match(/\d.*\d/));
          sorteos[juego] = [];
          for (let i = 0; i < Math.min(5, lines.length); i++) {
            let nums = lines[i].match(/\d+/g);
            if (nums) sorteos[juego].push(nums.map(x => parseInt(x)));
          }
          resultados[juego] = sorteos[juego][0] || [];
        } catch (e) {
          resultados[juego] = [];
          sorteos[juego] = [];
        }
      }
      return {resultados, sorteos};
    }

    function calcularAciertos(usuario, oficial) {
      return usuario.filter(n => oficial.includes(n)).length;
    }
    function calcularDesviacion(usuario, oficial) {
      let total = 0;
      usuario.forEach(n => {
        let minDiff = Math.min(...oficial.map(o => Math.abs(o - n)));
        total += minDiff;
      });
      return (usuario.length > 0) ? (total / usuario.length).toFixed(2) : "-";
    }
    function mostrarResultado(juego, usuario, oficial) {
      const aciertos = calcularAciertos(usuario, oficial);
      const desviacion = calcularDesviacion(usuario, oficial);
      return `<div class="result">
        <strong>${juego}:</strong><br>
        <span class="aciertos">Aciertos: ${aciertos} / ${oficial.length}</span><br>
        <span class="desviacion">Desviaci√≥n promedio: ${desviacion}</span><br>
        <span>Resultado oficial: ${oficial.join(", ")}</span><br>
        <span>Tus n√∫meros: ${usuario.join(", ")}</span>
      </div>`;
    }
    async function poblarSorteos() {
      const {resultados, sorteos} = await obtenerResultados();
      window._sorteos = sorteos;
    }

    document.addEventListener('DOMContentLoaded', poblarSorteos);

    document.getElementById('validador-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      let html = "";
      const sorteos = window._sorteos || {};
      ['melate','retro','tris','chispazo'].forEach(juego => {
        const val = document.getElementById(juego).value.trim();
        const validarTodos = document.getElementById(juego+'-todos').checked;
        if (val && sorteos[juego]) {
          const usuario = val.split(/[,	\s]+/).map(x => parseInt(x,10)).filter(x => !isNaN(x));
          if (validarTodos) {
            (sorteos[juego]||[]).forEach((nums, i) => {
              html += mostrarResultado(juego.charAt(0).toUpperCase()+juego.slice(1)+` (Sorteo ${i+1})`, usuario, nums);
            });
          } else if (sorteos[juego][0]) {
            html += mostrarResultado(juego.charAt(0).toUpperCase()+juego.slice(1)+` (Sorteo 1)`, usuario, sorteos[juego][0]);
          }
        }
      });
      document.getElementById('resultados').innerHTML = html || '<div class="result">Ingresa tus n√∫meros para validar.</div>';
    });
  </script>
</body>
</html>
